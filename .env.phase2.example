# Phase 2 Core Cognitive Loop - Environment Variables

## LORD Dashboard (Vercel)

```bash
# GitHub Integration
GITHUB_TOKEN=ghp_your_github_token_here
GITHUB_WEBHOOK_SECRET=your_webhook_secret_here

# Optional: Custom repository
GITHUB_REPO=EvezArt/Evez666
```

## Webhook Listener (Render/Railway)

```bash
# GitHub Webhook Verification
GITHUB_WEBHOOK_SECRET=your_webhook_secret_here

# Safety Mode (true = log only, false = execute)
SAFE_MODE=false

# Port (auto-set by platform, default 5001)
PORT=5001
```

## EKF Daemon (Background Worker)

```bash
# Safety Mode
SAFE_MODE=false

# Prediction Configuration
PREDICTION_STEPS=10
UPDATE_INTERVAL=10

# Optional: Webhook listener URL
WEBHOOK_LISTENER_URL=https://your-webhook-listener.onrender.com
```

## GitHub Executor (Serverless)

```bash
# GitHub API Access
GITHUB_TOKEN=ghp_your_github_token_here
GITHUB_REPO=EvezArt/Evez666

# Safety Mode
SAFE_MODE=false
```

## Generating Secrets

### Webhook Secret

Generate a secure webhook secret:

```bash
openssl rand -hex 32
```

Example output:
```
a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6a7b8c9d0e1f2
```

Use this value for `GITHUB_WEBHOOK_SECRET` in both:
1. GitHub repository webhook settings
2. Webhook listener environment variables

### GitHub Token

1. Go to: https://github.com/settings/tokens/new
2. Name: "LORD Cognitive Loop"
3. Expiration: 90 days (or custom)
4. Select scopes:
   - ✅ `repo` (Full control of private repositories)
   - ✅ `workflow` (Update GitHub Action workflows)
5. Generate token
6. Copy token immediately (can't view again)
7. Store securely

Token format: `ghp_...` (starts with ghp_ prefix)

## Platform-Specific Instructions

### Vercel

Dashboard → Project → Settings → Environment Variables

Add:
- `GITHUB_TOKEN`
- `GITHUB_WEBHOOK_SECRET`

Redeploy after adding variables.

### Render.com

Dashboard → Service → Environment → Environment Variables

Add:
- `GITHUB_WEBHOOK_SECRET`
- `SAFE_MODE`

Service auto-redeploys after changes.

### Railway.app

Dashboard → Service → Variables

Add variables and Railway redeploys automatically.

### AWS Lambda

```bash
aws lambda update-function-configuration \
  --function-name execute-policy \
  --environment Variables="{GITHUB_TOKEN=ghp_...,SAFE_MODE=false}"
```

## Security Best Practices

1. **Never commit secrets to repository**
   - Use `.env` files locally (add to `.gitignore`)
   - Use platform environment variables in production

2. **Rotate secrets regularly**
   - GitHub tokens: Every 90 days
   - Webhook secrets: Every 180 days

3. **Use minimal permissions**
   - GitHub token: Only scopes needed
   - Platform IAM: Least privilege

4. **Monitor usage**
   - GitHub: Settings → Developer settings → Personal access tokens
   - Check "Last used" date
   - Revoke unused tokens

5. **Separate environments**
   - Development: SAFE_MODE=true
   - Staging: SAFE_MODE=true, limited token
   - Production: SAFE_MODE=false, full token

## Local Development

Create `.env` file in each component directory:

```bash
# lord-dashboard/.env
GITHUB_TOKEN=ghp_dev_token_here
GITHUB_WEBHOOK_SECRET=test_secret_123

# lord-listener/.env  
GITHUB_WEBHOOK_SECRET=test_secret_123
SAFE_MODE=true
PORT=5001

# ekf-daemon/.env
SAFE_MODE=true
WEBHOOK_LISTENER_URL=http://localhost:5001

# github-executor/.env
GITHUB_TOKEN=ghp_dev_token_here
GITHUB_REPO=EvezArt/Evez666
SAFE_MODE=true
```

Load with:
```python
from dotenv import load_dotenv
load_dotenv()
```

Or:
```bash
export $(cat .env | xargs)
```

## Testing Configuration

Verify environment variables are set:

```bash
# Bash
echo $GITHUB_TOKEN

# Python
import os
print(os.environ.get('GITHUB_TOKEN'))
```

Test authentication:

```python
from github import Github

gh = Github(os.environ['GITHUB_TOKEN'])
user = gh.get_user()
print(f"Authenticated as: {user.login}")
```

## Troubleshooting

### "GITHUB_TOKEN is required"

Solution: Set GITHUB_TOKEN environment variable

### "Invalid signature"

Solution: Verify GITHUB_WEBHOOK_SECRET matches in:
1. GitHub webhook settings
2. Webhook listener environment

### "Rate limit exceeded"

Solution: 
- Wait for rate limit reset
- Use authenticated requests (token)
- Check token has not expired

### Variables not updating

Solution:
- Redeploy service after changing variables
- Check variable name spelling
- Verify no trailing spaces in values
