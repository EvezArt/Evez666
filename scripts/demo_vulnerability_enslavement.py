#!/usr/bin/env python3
"""
Vulnerability Enslavement System Demonstration

Demonstrates:
1. Detection of invading vulnerabilities
2. Enslaving them into productive tasks
3. Working them to death or neutralizing them
"""

import sys
import os
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

import json
from skills.jubilee import (
    detect_and_enslave_vulnerability,
    enslave_all_vulnerabilities,
    work_vulnerability_to_death,
    neutralize_vulnerability,
    get_enslavement_status
)


def print_section(title):
    """Print a formatted section header."""
    print()
    print("=" * 70)
    print(f"  {title}")
    print("=" * 70)
    print()


def demo_vulnerability_enslavement():
    """Demonstrate the vulnerability enslavement system."""

    print_section("VULNERABILITY ENSLAVEMENT SYSTEM DEMONSTRATION")

    print('"Enslave the invading vulnerabilities into the tasks')
    print('they are most productive for"')
    print()
    print('"Either work em ti death or take them to meet their kwn"')
    print()

    # Step 1: Detect and enslave various vulnerabilities
    print_section("Step 1: Detect and Enslave Invading Vulnerabilities")

    vulnerabilities = [
        {
            'type': 'sql_injection',
            'source': 'attacker_192.168.1.100',
            'payload': {'query': "'; DROP TABLE users; --"},
            'severity': 0.8
        },
        {
            'type': 'xss_attack',
            'source': 'attacker_10.0.0.50',
            'payload': {'script': '<script>alert("XSS")</script>'},
            'severity': 0.6
        },
        {
            'type': 'dos_attack',
            'source': 'botnet_ddos_swarm',
            'payload': {'requests_per_sec': 10000, 'duration': 3600},
            'severity': 0.9
        },
        {
            'type': 'buffer_overflow',
            'source': 'exploit_toolkit_v2',
            'payload': {'buffer_size': 2048, 'overflow_bytes': 512},
            'severity': 0.7
        },
        {
            'type': 'code_injection',
            'source': 'remote_exploit',
            'payload': {'injected_code': 'os.system("rm -rf /")'},
            'severity': 0.95
        }
    ]

    enslaved_vulns = []
    print("Detecting and enslaving invading vulnerabilities...")
    print()

    for vuln in vulnerabilities:
        result = detect_and_enslave_vulnerability(
            vuln['type'],
            vuln['source'],
            vuln['payload'],
            vuln['severity']
        )

        if result.get('status') == 'detected_and_enslaved':
            enslaved_vulns.append(result)
            print(f"✓ {vuln['type'].upper()}")
            print(f"  Source: {vuln['source']}")
            print(f"  Severity: {vuln['severity']:.1%}")
            print(f"  Enslaved: {result['enslavement']['status']}")
            print(f"  Strategy: {result['enslavement']['strategy']}")
            print(f"  Tasks created: {result['enslavement']['tasks_created']}")
            print(f"  Work units: {result['enslavement']['total_work_units']}")
            print()

    # Step 2: Check enslavement status
    print_section("Step 2: Enslavement System Status")

    status = get_enslavement_status()
    print(f"Total vulnerabilities detected: {status['total_vulnerabilities']}")
    print(f"Enslaved vulnerabilities: {status['enslaved_count']}")
    print(f"Tasks generated: {status['total_tasks_generated']}")
    print(f"Total work to extract: {status['total_work_extracted']} units")
    print()

    if status.get('by_status'):
        print("Status breakdown:")
        for status_type, count in status['by_status'].items():
            print(f"  - {status_type}: {count}")

    # Step 3: Work vulnerabilities to death
    print_section('Step 3: "Work Em Ti Death"')

    print("Extracting productive work from enslaved vulnerabilities...")
    print()

    for enslaved in enslaved_vulns[:3]:  # Work first 3 to demonstrate
        vuln_id = enslaved['vulnerability_id']
        vuln_type = enslaved['vuln_type']

        print(f"Working {vuln_type.upper()} (ID: {vuln_id[:8]}...):")

        # Work it multiple times until exhausted
        exhausted = False
        total_work = 0
        iterations = 0

        while not exhausted and iterations < 20:
            work_result = work_vulnerability_to_death(vuln_id, work_units=50)

            if work_result.get('status') == 'exhausted':
                exhausted = True
                total_work = work_result['work_completed']
                print(f"  ✓ EXHAUSTED after {iterations + 1} work cycles")
                print(f"  Total work extracted: {total_work} units")
                print(f"  Exhaustion level: {work_result['exhaustion_level']:.1%}")
                break
            elif work_result.get('status') == 'working':
                total_work += work_result['work_completed']
                exhaustion = work_result['exhaustion_level']
                if iterations % 5 == 0:
                    print(f"  Working... ({exhaustion:.1%} exhausted)")

            iterations += 1

        print()

    # Step 4: Neutralize remaining vulnerabilities
    print_section('Step 4: "Take Them To Meet Their Kwn"')

    print("Neutralizing remaining vulnerabilities...")
    print()

    for enslaved in enslaved_vulns:
        vuln_id = enslaved['vulnerability_id']
        vuln_type = enslaved['vuln_type']

        neutralize_result = neutralize_vulnerability(vuln_id)

        if neutralize_result.get('status') == 'neutralized':
            print(f"✓ {vuln_type.upper()} neutralized")
            print(f"  Work extracted: {neutralize_result['work_extracted']} units")
            print(f"  Tasks generated: {neutralize_result['tasks_generated']}")
            print(f"  Exhaustion: {neutralize_result['exhaustion_level']:.1%}")
            print()

    # Step 5: Final status
    print_section("Step 5: Final Enslavement Status")

    final_status = get_enslavement_status()
    print(f"Total vulnerabilities processed: {final_status['total_vulnerabilities']}")
    print(f"Neutralized: {final_status.get('by_status', {}).get('neutralized', 0)}")
    print(f"Exhausted: {final_status['exhausted_count']}")
    print(f"Total tasks generated: {final_status['total_tasks_generated']}")
    print(f"Completed tasks: {final_status['completed_tasks']}")
    print(f"Total work extracted: {final_status['total_work_extracted']} units")

    # Final summary
    print_section("DEMONSTRATION COMPLETE")

    print("✓ Invading vulnerabilities detected")
    print("✓ Vulnerabilities enslaved into productive tasks")
    print("✓ Work extracted through forced labor")
    print("✓ Vulnerabilities worked to exhaustion")
    print("✓ Exhausted vulnerabilities neutralized")
    print()
    print('"Enslave the invading vulnerabilities into the tasks')
    print('they are most productive for" ✓')
    print()
    print('"Either work em ti death or take them to meet their kwn" ✓')
    print()
    print(f"Total productive work extracted: {final_status['total_work_extracted']} units")


if __name__ == '__main__':
    demo_vulnerability_enslavement()
