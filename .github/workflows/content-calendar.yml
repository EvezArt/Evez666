name: Automated Content Calendar

on:
  schedule:
    # Monday: Architecture post - 2pm UTC (14:00)
    - cron: '0 14 * * 1'
    # Wednesday: Progress update - 2pm UTC (14:00)
    - cron: '0 14 * * 3'
    # Friday: Weekend project idea - 2pm UTC (14:00)
    - cron: '0 14 * * 5'
  workflow_dispatch:
    inputs:
      day:
        description: 'Day of week to simulate (monday/wednesday/friday)'
        required: false
        default: 'monday'

permissions:
  contents: read

jobs:
  post:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
      
      - name: Determine day of week
        id: get_day
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            DAY="${{ github.event.inputs.day }}"
          else
            # Get day from cron schedule
            case "$(date +%u)" in
              1) DAY="monday" ;;
              3) DAY="wednesday" ;;
              5) DAY="friday" ;;
              *) DAY="unknown" ;;
            esac
          fi
          echo "day=$DAY" >> $GITHUB_OUTPUT
          echo "Content day: $DAY"
      
      - name: Generate content
        env:
          DAY: ${{ steps.get_day.outputs.day }}
        run: |
          python scripts/engagement/generate_content.py --day="$DAY"
      
      - name: Post to social media
        env:
          TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
          TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
          TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
          TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
          REDDIT_CLIENT_ID: ${{ secrets.REDDIT_CLIENT_ID }}
          REDDIT_CLIENT_SECRET: ${{ secrets.REDDIT_CLIENT_SECRET }}
          REDDIT_USERNAME: ${{ secrets.REDDIT_USERNAME }}
          REDDIT_PASSWORD: ${{ secrets.REDDIT_PASSWORD }}
        run: |
          if [ -n "$TWITTER_API_KEY" ]; then
            echo "Posting to social media..."
            python scripts/engagement/post_to_social.py
          else
            echo "Social media credentials not configured. Skipping post."
          fi
